import{u as ae,b as C,H as le,s as S,e as l,o as i,c as _,a as v,f as s,w as a,j as ie,k as I,n as re,t as j,g as p,h as ue,i as y,F as x,r as q,M as h,G as pe,_ as de}from"./index-1858008c.js";const ce={style:{float:"left","user-select":"none"}},me={style:{"min-height":"100px"},slot:"body"},fe={style:{"margin-left":"10px"}},ge={style:{"margin-left":"10px"}},_e={key:0},ve={style:{display:"inline-block",float:"right",width:"200px","margin-left":"10px"}},ye={__name:"QuestionMsgView",setup(he){const z=ae(),$=C(),U=C({records:[{id:1,title:"这是一条通知",details:"这是通知详情",addtime:"2024-01-10T11:15:42.000+00:00"}],total:1,size:10,current:1,pages:1}),e=le({options:{group:0,course:0,specia:1},isUpdate:!1,insertStep:0,selectedRowKeys:[],visible:!1,page:1,search:"",pojo:{question:"",answers:["","","",""],ranswer:[],parse:"",groupid:1,difficulty:3,enable:1}}),d=C([]),w=C([]),f=C([]);S.get("/specia/getAllFull").then(t=>{console.log(t.data),f.value=t.data,e.specia=t.data[0].id,d.value=f.value[0].questionCourse,e.options.course=d.value[0].id,w.value=d.value[0].questionGroups,e.options.group=w.value[0].id}).catch(t=>{console.error("There was an error!",t)});function N(t){f.value.find(o=>o.id===t).questionCourse.length>0?(d.value=f.value.find(o=>o.id===t).questionCourse,e.options.course=d.value[0].id):(d.value=[],e.options.course=null),K()}function K(){d.value.find(t=>t.id===e.options.course)!==void 0&&d.value.find(t=>t.id===e.options.course).questionGroups.length>0?(w.value=d.value.find(t=>t.id===e.options.course).questionGroups,e.options.group=w.value[0].id):(w.value=[],e.options.group=null)}function b(){S.get(`/question/selectLimit?page=${e.page}&search=${e.search}`).then(t=>{U.value=t.data,console.log(t)})}b();async function P(){if(e.options.group==null){h.error("请选择课程");return}let t={...e.pojo};t.answers=JSON.stringify(t.answers),t.ranswer=t.ranswer.toString(),t.groupid=e.options.group,console.log(t),S.post(`/question/${e.isUpdate?"update":"insert"}`,t).then(o=>{console.log(o),b(),o.data>0?h.success((e.isUpdate?"修改":"新增")+"成功"):h.error((e.isUpdate?"修改":"新增")+"失败"),e.visible=!1})}function E(){if(e.selectedRowKeys.length>0){const t=pe({header:"提示",body:"您确认删除所选 "+e.selectedRowKeys.length+" 项数据吗？",confirmBtn:{content:"删除",theme:"danger"},cancelBtn:{content:"取消",variant:"outline"},onConfirm:({e:o})=>{G(e.selectedRowKeys),t.hide()}})}else h.error("请选择要删除的项")}function G(t){S.post("/question/deletes?ids="+t.toString()).then(o=>{console.log(o),b(),o.data>0?h.success("删除成功"):h.error("删除失败")})}async function F(t){e.visible=!0,e.isUpdate=!0,e.pojo={...t},e.pojo.answers=JSON.parse(t.answers),e.pojo.ranswer=t.ranswer.split(","),e.pojo.ranswer.forEach((c,u)=>e.pojo.ranswer[u]=parseInt(c));let o=Q(e.pojo.groupid);e.options={...o},e.insertStep=0}async function O(){if(typeof await $.value.validate()=="boolean"){let t=!1;e.pojo.answers.forEach(o=>{o==""&&(t=!0)}),t?h.error("请填写完整"):e.insertStep++}}function Q(t){for(const o of f.value)for(const c of o.questionCourse){const u=c.questionGroups.find(m=>m.id===t);if(u)return{specia:o.id,course:c.id,group:u.id}}return{specia:null,course:null,group:null}}function J(t){for(const o of f.value){const c=o.questionCourse.find(u=>u.questionGroups.some(m=>m.id===t));if(c){const u=c.questionGroups.find(m=>m.id===t);return u?u.name:""}}return""}return(t,o)=>{const c=l("t-step-item"),u=l("t-steps"),m=l("t-textarea"),V=l("t-icon"),k=l("t-button"),g=l("t-form-item"),L=l("t-checkbox"),A=l("t-checkbox-group"),M=l("t-form"),H=l("t-radio"),W=l("t-radio-group"),R=l("t-option"),B=l("t-select"),X=l("t-dialog"),Y=l("t-tag"),Z=l("t-space"),ee=l("t-pagination"),oe=l("t-input"),T=l("t-link"),te=l("t-popconfirm"),ne=l("t-table"),se=l("t-card");return i(),_("div",{style:re([{"background-position":"center"},`background-image: url('${I(z).darkT?`//pic.sherry.games/assets/image/mobileback/th (${Math.round(Math.random()*30)}).jpg`:`//pic.sherry.games/assets/image/mobileback/th (${Math.round(Math.random()*30)}).jpg`}');background-repeat: no-repeat;background-size: cover;  `])},[v("div",{class:ie(I(z).darkT?"boxdark":"box"),style:{"min-height":"100vh","backdrop-filter":"blur(20px)","padding-top":"3vh","padding-bottom":"10px"}},[s(se,{bordered:!1,hoverShadow:"",style:{width:"96%",margin:"0 auto","min-height":"94vh"}},{default:a(()=>[s(X,{placement:"center",visible:e.visible,"onUpdate:visible":o[9]||(o[9]=n=>e.visible=n),"confirm-btn":{content:"下一步",variant:"outline"},width:"640px",onConfirm:O},{header:a(()=>[v("span",ce,j(e.isUpdate?"修改试题":"创建试题"),1),s(u,{id:"setpicon",style:{"text-decoration":"none",width:"320px",margin:"0 auto","letter-spacing":"1px","user-select":"none"},class:"bbb",modelValue:e.insertStep,"onUpdate:modelValue":o[0]||(o[0]=n=>e.insertStep=n)},{default:a(()=>[s(c,{title:"编辑"}),s(c,{title:"选择分类"})]),_:1},8,["modelValue"])]),footer:a(()=>[e.insertStep>0?(i(),_("div",_e,[s(k,{ghost:"",onClick:o[8]||(o[8]=n=>e.insertStep--),theme:"primary"},{default:a(()=>[p(" 上一步 ")]),_:1}),s(k,{onClick:P,theme:"primary"},{default:a(()=>[p(" 完成 ")]),_:1})])):ue("",!0)]),default:a(()=>[v("div",me,[e.insertStep<1?(i(),y(M,{key:0,layout:"inline",ref_key:"form",ref:$,rules:{question:[{required:!0,message:"题目不能为空"}],ranswer:[{required:!0,message:"内容不能为空"}]},data:e.pojo,colon:!0},{default:a(()=>[s(g,{style:{width:"96%",margin:"8px 0"},label:"题目",name:"question"},{default:a(()=>[s(m,{autosize:{minRows:1},modelValue:e.pojo.question,"onUpdate:modelValue":o[1]||(o[1]=n=>e.pojo.question=n),placeholder:"请输入内容"},null,8,["modelValue"]),v("div",fe,[s(k,{onClick:o[2]||(o[2]=n=>e.pojo.answers.push("")),shape:"circle"},{default:a(()=>[s(V,{name:"add"})]),_:1})])]),_:1}),(i(!0),_(x,null,q(e.pojo.answers,(n,r)=>(i(),y(g,{style:{width:"96%",margin:"8px 0"},label:"选项"+(r+1),name:"answers"},{default:a(()=>[s(m,{autosize:{minRows:1},modelValue:e.pojo.answers[r],"onUpdate:modelValue":D=>e.pojo.answers[r]=D,placeholder:"请输入内容"},null,8,["modelValue","onUpdate:modelValue"]),v("div",ge,[s(k,{onClick:D=>{e.pojo.ranswer=[],e.pojo.answers.length>2?e.pojo.answers.splice(r,1):t.$message("warning","需要至少保留两个选项")},variant:"outline",shape:"circle"},{default:a(()=>[s(V,{name:"close"})]),_:2},1032,["onClick"])])]),_:2},1032,["label"]))),256)),s(g,{style:{width:"96%",margin:"8px 0"},label:"正确答案",name:"ranswer"},{default:a(()=>[s(A,{modelValue:e.pojo.ranswer,"onUpdate:modelValue":o[3]||(o[3]=n=>e.pojo.ranswer=n)},{default:a(()=>[(i(!0),_(x,null,q(e.pojo.answers,(n,r)=>(i(),y(L,{key:r,value:r+1},{default:a(()=>[p("选项 "+j(r+1),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(g,{style:{width:"96%",margin:"8px 0"},label:"试题解析",name:"parse"},{default:a(()=>[s(m,{autosize:{minRows:1},modelValue:e.pojo.parse,"onUpdate:modelValue":o[4]||(o[4]=n=>e.pojo.parse=n),placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["data"])):(i(),y(M,{key:1},{default:a(()=>[s(g,{label:"专业",name:"gender"},{default:a(()=>[s(W,{onChange:N,modelValue:e.options.specia,"onUpdate:modelValue":o[5]||(o[5]=n=>e.options.specia=n)},{default:a(()=>[(i(!0),_(x,null,q(f.value,({id:n,name:r})=>(i(),y(H,{value:n},{default:a(()=>[p(j(r),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1}),s(g,{label:"课程",name:"course"},{default:a(()=>[s(B,{modelValue:e.options.course,"onUpdate:modelValue":o[6]||(o[6]=n=>e.options.course=n)},{default:a(()=>[(i(!0),_(x,null,q(d.value,n=>(i(),y(R,{onClick:K,key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(g,{label:"章节",name:"group"},{default:a(()=>[s(B,{modelValue:e.options.group,"onUpdate:modelValue":o[7]||(o[7]=n=>e.options.group=n)},{default:a(()=>[(i(!0),_(x,null,q(w.value,n=>(i(),y(R,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}))])]),_:1},8,["visible"]),v("div",null,[s(Z,{size:6},{default:a(()=>[s(k,{size:"small",onClick:o[10]||(o[10]=n=>{e.visible=!0,e.isUpdate=!1,t.$refs.form.reset(),e.pojo.answers=["","","",""]}),theme:"primary"},{icon:a(()=>[s(V,{name:"add"})]),default:a(()=>[p(" 新建 ")]),_:1}),s(k,{size:"small",onClick:E,theme:"danger"},{icon:a(()=>[s(V,{name:"delete"})]),default:a(()=>[p(" 删除 ")]),_:1}),s(Y,{variant:"light-outline",theme:"primary",shape:"round",size:"small"},{default:a(()=>[p(" 共有"+j(U.value.total)+"条记录 ",1)]),_:1})]),_:1}),v("div",ve,[s(ee,{totalContent:!1,onChange:b,modelValue:e.page,"onUpdate:modelValue":o[11]||(o[11]=n=>e.page=n),theme:"simple",pageSize:15,showPageSize:!1,size:"small",total:U.value.total},null,8,["modelValue","total"])]),s(oe,{onInput:o[13]||(o[13]=n=>{e.page=1,b()}),modelValue:e.search,"onUpdate:modelValue":o[14]||(o[14]=n=>e.search=n),modelModifiers:{lazy:!0},size:"small",style:{width:"20%",float:"right"},placeholder:"输入内容"},{suffixIcon:a(()=>[s(V,{onClick:o[12]||(o[12]=n=>{e.page=1,b()}),style:{cursor:"pointer"},name:"search"})]),_:1},8,["modelValue"])]),s(ne,{"row-key":"id","selected-row-keys":e.selectedRowKeys,"onUpdate:selectedRowKeys":o[15]||(o[15]=n=>e.selectedRowKeys=n),data:U.value.list,columns:[{colKey:"row-select",type:"multiple",width:60},{colKey:"id",title:"ID"},{colKey:"question",title:"标题",ellipsis:!0},{colKey:"answers",title:"详情",ellipsis:!0},{colKey:"groupid",title:"章节",ellipsis:!0},{colKey:"parse",title:"详情",ellipsis:!0},{title:"操作",colKey:"operation"}]},{groupid:a(({row:n})=>[p(j(J(n.groupid)),1)]),operation:a(({row:n})=>[s(T,{onClick:r=>F(n),theme:"primary",hover:"color"},{default:a(()=>[p(" 修改 ")]),_:2},1032,["onClick"]),p("  "),s(te,{theme:"danger",confirmBtn:{theme:"danger"},onConfirm:r=>G(n.id),cancelBtn:{variant:"outline"},content:"确认删除吗"},{default:a(()=>[s(T,{theme:"danger",hover:"color"},{default:a(()=>[p(" 删除 ")]),_:1})]),_:2},1032,["onConfirm"])]),_:1},8,["selected-row-keys","data"])]),_:1})],2)],4)}}};const be=de(ye,[["__scopeId","data-v-86575a67"]]);export{be as default};
