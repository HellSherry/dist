import{_ as $,u as Y,b as w,H as E,e as a,o as m,c as H,f as t,w as o,a as u,n as N,k as p,s as _,M as i,g as r,t as k,l as O,i as K,G as P}from"./index-1858008c.js";const T={style:{position:"relative",height:"102vh"}},q={style:{display:"inline-block",float:"right",width:"200px","margin-left":"10px"}},A={__name:"OnlineUsersView",setup(G){const g=Y(),f=w(),d=w({records:[{id:1,title:"这是一条通知",details:"这是通知详情",addtime:"2024-01-10T11:15:42.000+00:00"}],total:1,size:10,current:1,pages:1}),e=E({isUpdate:!1,selectedRowKeys:[],visible:!1,page:1,search:"",pojo:{title:"",details:""}});function c(){_.get(`/online/getUser?page=${e.page}`).then(l=>{d.value=l.data,console.log(l)})}c();async function V(){typeof await f.value.validate()=="boolean"&&_.post(`/message/${e.isUpdate?"update":"insert"}`,e.pojo).then(l=>{console.log(11121),console.log(l),c(),l.data>0?i.success((e.isUpdate?"修改":"新增")+"成功"):i.error((e.isUpdate?"修改":"新增")+"失败"),e.visible=!1})}function U(){if(e.selectedRowKeys.length>0){const l=P({header:"提示",body:"您确认退出 "+e.selectedRowKeys.length+"位用户登录吗？",confirmBtn:{content:"确认",theme:"danger"},cancelBtn:{content:"取消",variant:"outline"},onConfirm:({e:n})=>{y(e.selectedRowKeys),l.hide()}})}else i.error("请选择要退出的用户")}function y(l){_.post("/online/delete",typeof l=="object"?l:[l]).then(n=>{console.log(n),c(),n.data>0?i.success("退出成功"):i.error("退出失败")})}return(l,n)=>{const h=a("t-input"),v=a("t-form-item"),x=a("t-form"),j=a("t-dialog"),C=a("t-icon"),I=a("t-button"),b=a("t-tag"),z=a("t-space"),B=a("t-pagination"),D=a("t-link"),M=a("t-popconfirm"),R=a("t-table"),S=a("t-card");return m(),H("div",T,[t(j,{placement:"center",header:e.isUpdate?"编辑通知":"新增通知",visible:e.visible,"on-confirm":()=>V(),"on-close":()=>e.visible=!1},{default:o(()=>[t(x,{layout:"inline",ref_key:"form",ref:f,rules:{title:[{required:!0,message:"标题不能为空"}],details:[{required:!0,message:"内容不能为空"}]},data:e.pojo,colon:!0},{default:o(()=>[t(v,{style:{width:"96%",margin:"8px 0"},label:"通知标题",name:"title"},{default:o(()=>[t(h,{modelValue:e.pojo.title,"onUpdate:modelValue":n[0]||(n[0]=s=>e.pojo.title=s),placeholder:"请输入内容"},null,8,["modelValue"])]),_:1}),t(v,{style:{width:"96%",margin:"8px 0"},label:"通知内容",name:"details"},{default:o(()=>[t(h,{modelValue:e.pojo.details,"onUpdate:modelValue":n[1]||(n[1]=s=>e.pojo.details=s),placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["data"])]),_:1},8,["header","visible","on-confirm","on-close"]),u("div",{style:N([{"background-position":"center"},`background-image: url('${p(g).darkT?`//pic.sherry.games/assets/image/mobileback/th (${Math.round(Math.random()*30)}).jpg`:`//pic.sherry.games/assets/image/mobileback/th (${Math.round(Math.random()*30)}).jpg`}');background-repeat: no-repeat;background-size: cover;min-height: 46vh ;margin-top: -20px`])},null,4),t(S,{bordered:!1,hoverShadow:"",style:{width:"96%",margin:"0 auto","margin-top":"-30px","min-height":"58vh"}},{default:o(()=>[u("div",null,[t(z,{size:6},{default:o(()=>[t(I,{size:"small",onClick:U,theme:"danger"},{icon:o(()=>[t(C,{name:"logout"})]),default:o(()=>[r(" 退出 ")]),_:1}),t(b,{variant:"light-outline",theme:"primary",shape:"round",size:"small"},{default:o(()=>[r(" 共有"+k(d.value.total)+"条记录 ",1)]),_:1})]),_:1}),u("div",q,[t(B,{totalContent:!1,onChange:c,modelValue:e.page,"onUpdate:modelValue":n[2]||(n[2]=s=>e.page=s),theme:"simple",showPageSize:!1,size:"small",total:d.value.total},null,8,["modelValue","total"])])]),t(R,{size:"small","row-key":"userId","selected-row-keys":e.selectedRowKeys,"onUpdate:selectedRowKeys":n[3]||(n[3]=s=>e.selectedRowKeys=s),data:d.value.list,columns:[{colKey:"row-select",type:"multiple",width:60},{colKey:"userId",title:"ID"},{colKey:"userEmail",title:"userEmail",ellipsis:!0},{colKey:"username",title:"username"},{colKey:"grade",title:"grade"},{colKey:"userImg",title:"userImg"},{colKey:"defaultAddress",title:"defaultAddress"},{colKey:"identity",title:"identity"},{colKey:"classid",title:"classid"},{title:"操作",colKey:"operation"}]},{addtime:o(({row:s})=>[r(k(p(O)(s.addtime).format("YYYY-MM-DD HH:mm:ss")),1)]),operation:o(({row:s})=>[s.userId!=p(g).loginUser.sub.userId?(m(),K(M,{key:0,theme:"danger",confirmBtn:{theme:"danger"},onConfirm:F=>y(s.userId),cancelBtn:{variant:"outline"},content:"确认删除吗"},{default:o(()=>[t(D,{theme:"danger",hover:"color"},{default:o(()=>[r(" 退出 ")]),_:1})]),_:2},1032,["onConfirm"])):(m(),K(b,{key:1},{default:o(()=>[r("我")]),_:1}))]),_:1},8,["selected-row-keys","data"])]),_:1})])}}},L=$(A,[["__scopeId","data-v-4623f488"]]);export{L as default};
