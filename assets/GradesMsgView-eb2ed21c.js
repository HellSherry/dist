import{b as u,x as U,e as i,o as p,i as K,w as t,g as c,t as f,k as H,l as v,c as V,f as n,_ as Z,H as ee,u as te,I as $,a as C,n as ae,s as I,F as G,r as Y}from"./index-1858008c.js";import{d as ne}from"./duration-8efe19a3.js";const le={key:2},oe={__name:"GradesDetail",props:["selectData","onlineUser"],setup(E){const _=E,r=u([{colKey:"userId",title:"ID",width:"60px"},{colKey:"answerContent",title:"考生",ellipsis:!0},{colKey:"score",title:"分数",sortType:"all",sorter:(o,d)=>o.score-d.score},{colKey:"answerTime",title:"时间",sortType:"all",sorter:(o,d)=>o.answerTime-d.answerTime},{title:"操作",colKey:"operation"}]),h=u([..._.selectData]);U(()=>_.selectData,o=>{h.value=[..._.selectData]});const D=u({}),w=(o,d)=>{console.log("sort-change",o,d),D.value=o,h.value=d.currentDataSource},g=o=>{h.value=o};return(o,d)=>{const y=i("t-tag"),x=i("t-link"),b=i("t-table");return p(),K(b,{size:"small","row-key":"index",columns:r.value,data:h.value,sort:D.value,"lazy-load":"",onSortChange:w,onDataChange:g},{answerTime:t(({row:m})=>[c(f(H(v).duration(m.answerTime).format("mm:ss")),1)]),score:t(({row:m})=>[_.onlineUser.some(k=>k==m.userId)?(p(),K(y,{key:0,size:"small",theme:"primary"},{default:t(()=>[c("正在考试")]),_:1})):m.score==null?(p(),K(y,{key:1,size:"small",theme:"danger"},{default:t(()=>[c("未提交")]),_:1})):(p(),V("span",le,f(m.score),1))]),operation:t(({row:m})=>[n(x,{theme:"primary",hover:"color",onClick:k=>o.openView(m)},{default:t(()=>[c(" 预览 ")]),_:2},1032,["onClick"]),c("  "),n(x,{theme:"primary",hover:"color",onClick:k=>o.openGrades(m)},{default:t(()=>[c(" 成绩 ")]),_:2},1032,["onClick"])]),_:1},8,["columns","data","sort"])}}};const se={style:{position:"relative",height:"102vh"}},re={style:{display:"inline-block",float:"right",width:"200px","margin-left":"10px"}},ie={style:{padding:"2px"},theme:"success",variant:"light"},ce={style:{position:"relative",width:"100%"}},de={style:{width:"100%",position:"relative",height:"36px","margin-top":"-8px"}},ue={__name:"GradesMsgView",setup(E){const _=u(0),r=ee({page:1,search:"",time:[]});v.extend(ne);const h=u(!1),D=te(),w=u([{paperid:1,papername:"第一条测试试卷",questions:`[\r
  "1697182447.215191",\r
  "1697182455.7710226",\r
  "1697182460.4997933",\r
  "1697182466.5208726",\r
  "1697182472.274864",\r
  "1697182478.4024422",\r
  "1697182484.2858622",\r
  "1697182491.1385913",\r
  "1697182502.916686",\r
  "1697182513.1574242",\r
  "1697182523.9296796",\r
  "1697182536.179753",\r
  "1697182548.0525",\r
  "1697182556.697243",\r
  "1697182565.346125",\r
  "1697182572.125598",\r
  "1697182584.0691957",\r
  "1697182592.7712471",\r
  "1697182602.657546",\r
  "1697182612.7260299",\r
  "1697182625.055601",\r
  "1697182639.1223602",\r
  "1697182651.017039",\r
  "1697182662.9913886",\r
  "1697182675.3650398",\r
  "1697182690.1543",\r
  "1697182701.2358558",\r
  "1697182715.3210168",\r
  "1697182729.3673716",\r
  "1697182742.6456878",\r
  "1697182753.112941",\r
  "1697182764.8161106",\r
  "1697182781.5966773",\r
  "1697182792.5887868",\r
  "1697182807.3700113",\r
  "1697182824.35289",\r
  "1697182834.4852557",\r
  "1697182844.3831558",\r
  "1697182858.3031824",\r
  "1697182869.1886208",\r
  "1697182880.4490285",\r
  "1697182909.0475578",\r
  "1697182923.2650566",\r
  "1697182933.1916134",\r
  "1697182944.2247226",\r
  "1697182956.553987",\r
  "1697182962.9953659",\r
  "1697182977.1483552",\r
  "1697182989.2608874",\r
  "1697183009.544582",\r
  "1697183021.0839071"\r
]`,creatorusername:"汤凯旋",totalscore:100,starttime:"2023-12-26T20:42:58.000+00:00",duration:1,classid:null}]),g=u([]),o=u([]),d=u(),y=u();function x(){let a="";r.search!==""&&r.search!==void 0&&(a+="&search="+r.search),typeof r.time=="object"&&r.time.length>0?a+="&starttime="+r.time[0]+"&endtime="+r.time[1]:a+="&endtime="+v().format("YYYY-MM-DD- HH:mm"),console.log(a),I.post("/paper/get?page="+r.page+a).then(e=>{console.log(e.data),_.value=e.data.total,w.value=e.data.list,w.value.forEach(s=>{s.starttime=v(s.starttime).format("YY年MM月DD日 HH:mm"),s.classid=[],s.paperClasses.forEach(z=>{s.classid.push(z.name)})})}).catch(e=>{console.error("There was an error!",e)})}const b=u([]);x();function m(){I.get("/exam/selectGrades?classId="+d.value+"&paperId="+y.value).then(a=>{console.log(a),g.value=a.data,b.value=[],I.get("/exam/getUserExamsAreOngoing?paperid="+y.value).then(e=>{e.data.forEach(s=>{b.value.push(s.substring(s.indexOf(":")+1,s.indexOf("-startTime")))})})})}u({最近7天:v().add(7,"day"),最近3天:v().add(3,"day"),今天:v()}),U(r,()=>{x()});const k=$(()=>{let a=[];return g.value.forEach(e=>{a.push({学号:e.userId,姓名:e.answerContent,成绩:e.score==null?"未提交":e.score,时间:e.answerTime==null?"未提交":v.duration(e.answerTime).format("mm:ss"),班级:o.value.find(s=>s.classid==d.value).name})}),a});function j(a){h.value=!0,o.value=[{classid:"",name:"全部"},...a.paperClasses],y.value=a.paperid,d.value==o.value[1].classid?m():d.value=o.value[1].classid}const B=$(()=>{let a=0,e=0;return g.value.forEach(s=>{s.score!=null&&(a++,e+=s.score)}),a==0?0:(e/a).toFixed(1)}),F=$(()=>{let a=0;return g.value.forEach(e=>{e.score==null&&a++}),a});function N(a){window.open("","","width=600 ,height=2000,top=100,left=600,location=no,menubar=no,status=no,titlebar=no,toolbar=no").document.write(`<img style="width: 100%" src='//pic.sherry.games/assets/paperImg/${a.paperid}.png'/>`)}return U(d,()=>{m()}),(a,e)=>{const s=i("t-icon"),z=i("t-button"),T=i("t-tag"),O=i("t-pagination"),P=i("t-date-range-picker"),A=i("t-input"),S=i("t-link"),q=i("t-table"),L=i("t-card"),J=i("t-option"),Q=i("t-select"),R=i("download-excel"),W=i("t-space"),X=i("t-drawer");return p(),V("div",se,[C("div",{style:ae([{"background-position":"center"},`background-image: url('${H(D).darkT?`//pic.sherry.games/assets/image/mobileback/th (${Math.round(Math.random()*30)}).jpg`:`//pic.sherry.games/assets/image/mobileback/th (${Math.round(Math.random()*30)}).jpg`}');background-repeat: no-repeat;background-size: cover;min-height: 46vh ;margin-top: -20px`])},null,4),n(L,{bordered:!1,hoverShadow:"",style:{width:"96%",margin:"0 auto","margin-top":"-30px","min-height":"58vh"}},{default:t(()=>[C("div",null,[n(z,{size:"small",onClick:e[0]||(e[0]=l=>a.$router.push("/manage/papers")),theme:"primary"},{icon:t(()=>[n(s,{name:"add"})]),default:t(()=>[c(" 新建 ")]),_:1}),n(T,{variant:"light-outline",theme:"primary",style:{"margin-left":"6px"},shape:"round",size:"small"},{default:t(()=>[c("共有"+f(_.value)+"条记录",1)]),_:1}),C("div",re,[n(O,{totalContent:!1,modelValue:r.page,"onUpdate:modelValue":e[1]||(e[1]=l=>r.page=l),theme:"simple",showPageSize:!1,size:"small",total:_.value},null,8,["modelValue","total"])]),n(P,{modelValue:r.time,"onUpdate:modelValue":e[2]||(e[2]=l=>r.time=l),presetsPlacement:"left",size:"small",style:{float:"right",width:"208px","margin-left":"10px"},clearable:""},null,8,["modelValue"]),n(A,{modelValue:r.search,"onUpdate:modelValue":e[3]||(e[3]=l=>r.search=l),modelModifiers:{lazy:!0},size:"small",style:{width:"20%",float:"right"},placeholder:"输入试卷名称",clearable:""},{suffixIcon:t(()=>[n(s,{style:{cursor:"pointer"},name:"search"})]),_:1},8,["modelValue"])]),n(q,{size:"small","row-key":"index",data:w.value,columns:[{colKey:"paperid",title:"ID"},{colKey:"papername",title:"试卷名",ellipsis:!0},{colKey:"creatorusername",title:"创建者"},{colKey:"totalscore",title:"总分"},{colKey:"classid",title:"参考班级"},{colKey:"starttime",title:"开始时间",width:"150px"},{colKey:"duration",title:"考试时长"},{title:"操作",colKey:"operation"}]},{classid:t(({row:l})=>[(p(!0),V(G,null,Y(l.classid,M=>(p(),V("span",ie,f(M),1))),256))]),operation:t(({row:l})=>[n(S,{theme:"primary",hover:"color",onClick:M=>N(l)},{default:t(()=>[c(" 预览 ")]),_:2},1032,["onClick"]),c("  "),n(S,{theme:"primary",hover:"color",onClick:M=>j(l)},{default:t(()=>[c(" 成绩 ")]),_:2},1032,["onClick"])]),_:1},8,["data"])]),_:1}),n(X,{"destroy-on-close":"",visible:h.value,"onUpdate:visible":e[5]||(e[5]=l=>h.value=l),size:"520"},{header:t(()=>[C("h3",ce,[c(" 成绩详情 "),n(Q,{modelValue:d.value,"onUpdate:modelValue":e[4]||(e[4]=l=>d.value=l),style:{position:"absolute","margin-top":"-24px",right:"0",width:"200px"}},{default:t(()=>[(p(!0),V(G,null,Y(o.value,l=>(p(),K(J,{key:l.classid,label:l.name,value:l.classid},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),default:t(()=>[C("div",de,[n(R,{style:{float:"right"},data:k.value,type:"xls",name:"成绩导出.xls"},{default:t(()=>[n(z,{variant:"outline"},{icon:t(()=>[n(s,{name:"upload"})]),default:t(()=>[c(" 导出Excel ")]),_:1})]),_:1},8,["data"]),n(W,{size:8},{default:t(()=>[n(T,{variant:"outline",theme:"primary"},{default:t(()=>[c(" 正在考试："+f(b.value.length),1)]),_:1}),n(T,{variant:"outline",theme:"danger"},{default:t(()=>[c(" 未提交："+f(F.value),1)]),_:1}),n(T,{variant:"outline",theme:"success"},{default:t(()=>[c(" 平均分："+f(B.value),1)]),_:1})]),_:1})]),n(oe,{onlineUser:b.value,selectData:g.value},null,8,["onlineUser","selectData"])]),_:1},8,["visible"])])}}},_e=Z(ue,[["__scopeId","data-v-325bba1d"]]);export{_e as default};
